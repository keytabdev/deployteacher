(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3109],{6482:function(e,t,a){Promise.resolve().then(a.bind(a,2956))},2956:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var r=a(9268),s=a(8856),n=a(771),l=a(1375),i=a(8852),o=a(6008),c=a(6006),d=a(8919),u=a(4824),m=a(443),p=a(3593),h=a(4088);function x(e){let{session:t}=e,{handleChange:a,handleSubmit:x,values:f,errors:g,thumbnail:b,setThumbnail:v,media:j,setMedia:y,course:N,setCourse:w,loading:C,courses:L}=function(e){let t=(0,o.useRouter)(),a=(0,u.useQueryClient)(),{handleChange:r,handleSubmit:m,values:p,errors:h}=(0,i.TA)({initialValues:{title:"",description:"",order:0},validationSchema:l.E,async onSubmit(e){await C(e)}}),[x,f]=(0,c.useState)({image:null,error:null,dataURL:null}),[g,b]=(0,c.useState)({image:null,error:null,dataURL:null}),[v,j]=(0,c.useState)({value:"",label:""}),{data:y}=(0,u.useQuery)(["select-courses"],()=>s.Z.getCourses(e.token,"?fields[0]=title"),{staleTime:1/0,onError:()=>d.Am.error("something went wrong at fetching courses please try again")}),{mutateAsync:N,isLoading:w}=(0,u.useMutation)(t=>n.Z.createLesson(e.token,t),{onSuccess:async e=>{let{data:r}=e;await a.invalidateQueries(["lessons","select-lessons"]),d.Am.success("Lesson created successfully"),t.push("/dashboard/lessons/".concat(r.id))}});async function C(e){let t=!0;if(x.image||(f({...x,error:"plese choose thumbnail image"}),t=!1),g.image||(b({...x,error:"plese choose media"}),t=!1),v.value||(d.Am.error("plese choose a course"),t=!1),t)try{let t=new FormData,a={...e,course:v.value};t.append("data",JSON.stringify(a)),t.append("files.thumbnail",null==x?void 0:x.image),t.append("files.media",g.image),await N(t)}catch(e){d.Am.error(e.response.data.message||"something went wrong, please try again!")}}return{handleChange:r,handleSubmit:m,values:p,errors:h,thumbnail:x,setThumbnail:f,media:g,setMedia:b,course:v,setCourse:j,loading:w,courses:y}}(t),k=null==L?void 0:L.data.map(e=>({value:e.id.toString(),label:e.attributes.title}));return(0,r.jsxs)("div",{className:"",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-xl font-bold",children:"Create a new lesson"}),(0,r.jsx)("p",{children:"Add the information about the lesson"})]}),(0,r.jsxs)("form",{onSubmit:x,className:"rounded-md bg-white p-3 shadow-md dark:bg-primaryBg",action:"",children:[(0,r.jsx)("div",{className:"mb-12",children:(0,r.jsx)(m.II,{name:"title",value:f.title,onChange:a,error:g.title,label:"Lesson title",variant:"filled"})}),(0,r.jsx)("div",{className:"mb-12",children:(0,r.jsx)(m.gx,{name:"description",value:f.description,onChange:a,error:g.description,label:"Lesson description",variant:"filled"})}),(0,r.jsx)("div",{className:"mb-12",children:(0,r.jsx)(m.II,{name:"order",value:f.order,onChange:a,error:g.order,label:"Lesson order",variant:"filled"})}),(0,r.jsx)("div",{className:"mb-12",children:(0,r.jsx)(p.Z,{label:"Lesson thumbnail",state:b,setState:v})}),(0,r.jsx)("div",{className:"mb-12",children:(0,r.jsx)(p.Z,{label:"Lesson media",state:j,setState:y})}),(0,r.jsx)("div",{className:"mb-12 grid grid-cols-1 gap-12  md:grid-cols-2 md:gap-8",children:(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{htmlFor:"",className:"mb-2 text-sm",children:"Choose a course"}),(0,r.jsx)(h.ZP,{value:N,onChange:e=>w({value:null==e?void 0:e.value.toString(),label:null==e?void 0:e.label}),options:k})]})}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(m.zx,{loading:C,type:"submit",className:"w-fit text-white",children:"Create lesson"})})]})]})}},3593:function(e,t,a){"use strict";a.d(t,{Z:function(){return m}});var r=a(9268),s=a(6394),n=a.n(s),l=a(6006),i=a(8919),o=a(1033),c=a(5372),d=a(9743),u=a(4769);function m(e){let{state:t,setState:a,label:s,url:m,thumbnail:p}=e,h=(0,l.useId)();async function x(e){let r=e.target.files;if(!r){a({...t,error:"please choose course image"});return}let s=new FileReader;s.readAsArrayBuffer(r[0]),s.addEventListener("error",()=>i.Am.error("cannot load the media please try choosing again!")),s.addEventListener("load",e=>{var s;let n=null===(s=e.target)||void 0===s?void 0:s.result;if(!n)return;let l=new Blob([n],{type:r[0].type}),i=URL.createObjectURL(l);a({...t,image:r[0],dataURL:i})})}return(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{htmlFor:"",className:"mb-2 text-sm",children:s}),t.image||!m?t.image?(0,r.jsxs)("div",{className:"relative flex flex-col gap-4",children:[t.image.type.includes("image")?(0,r.jsx)("div",{className:"relative h-[300px] w-full overflow-hidden rounded-md",children:(0,r.jsx)(n(),{src:"".concat(t.dataURL),alt:"",fill:!0,className:"rounded-md object-cover"})}):t.image.type.includes("pdf")?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(d.default,{url:t.dataURL})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("video",{className:" h-[300px] w-[500px]  rounded-md object-cover",controls:!0,children:(0,r.jsx)("source",{src:"".concat(t.dataURL),type:"video/mp4"})},"".concat(t.dataURL))}),(0,r.jsx)("label",{onClick:function(){a({...t,image:null})},htmlFor:"",className:"absolute right-[0.5em] top-[0.5em] flex cursor-pointer items-center justify-center rounded-full bg-gray-100 p-4 text-xl dark:bg-primaryBg dark:text-white",children:(0,r.jsx)(o.oHP,{})})]}):(0,r.jsxs)("div",{className:"",children:[(0,r.jsxs)("div",{className:"flex h-[200px] w-full max-w-[250px] items-center justify-center rounded-s-md border border-gray-300",children:[(0,r.jsx)("label",{htmlFor:h,children:(0,r.jsxs)("div",{className:"flex cursor-pointer flex-col items-center justify-center gap-2 ",children:[(0,r.jsx)(c.tpQ,{className:"text-3xl"}),(0,r.jsx)("p",{className:"text-sm",children:"choose file to upload"})]})}),(0,r.jsx)("input",{onChange:x,type:"file",id:h,className:"hidden"})]}),t.error&&(0,r.jsx)("small",{className:"text-red-400",children:t.error})]}):(0,r.jsxs)("div",{children:[(null==m?void 0:m.match(/jpeg|png|jpg|webp/))?(0,r.jsx)("div",{className:"relative h-[300px] w-full overflow-hidden rounded-md",children:(0,r.jsx)(n(),{src:"".concat(m),alt:"",fill:!0,className:"rounded-md object-cover"})}):(null==m?void 0:m.match(/pdf/))?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(u.default,{className:"text-primary bg-white border-primary",type:"button",onClick:()=>window.open("".concat(m),"__blank"),children:"Open PDF"})}):(0,r.jsx)("video",{className:"aspect-video rounded-md object-cover",controls:!0,children:(0,r.jsx)("source",{src:"".concat(m),type:"video/mp4"})}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{htmlFor:h,children:(0,r.jsxs)("div",{className:"flex cursor-pointer items-center gap-2 hover:text-primary",children:[(0,r.jsx)(c.tpQ,{className:"text-3xl"}),(0,r.jsx)("p",{className:"text-sm",children:"choose file to upload"})]})}),(0,r.jsx)("input",{onChange:x,type:"file",id:h,className:"hidden"})]})]})]})}a(6628)},443:function(e,t,a){"use strict";a.d(t,{zx:function(){return r.default},II:function(){return s.default},gx:function(){return i},ZD:function(){return o}});var r=a(4769);a(9510);var s=a(445);a(9743),a(3402);var n=a(9268);a(6006);let l={outline:"bg-white",filled:"bg-gray-100 dark:bg-primaryBg border-2 border dark:border-gray-500 dark:focus-within:border-primary focus-within:border-primary"};var i=function(e){let{label:t,variant:a,error:r,...s}=e;return(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("label",{htmlFor:"",className:"mb-2 text-sm",children:t}),(0,n.jsx)("textarea",{...s,className:"h-[200px] resize-none  rounded-md px-2 py-3 outline-none ".concat(l[a])}),r&&(0,n.jsx)("small",{className:"mt-1 text-sm text-red-500",children:r})]})};function o(e){let{title:t,value:a,onChange:r,name:s}=e;return(0,n.jsxs)("label",{className:"relative w-fit inline-flex items-center cursor-pointer",children:[(0,n.jsx)("input",{name:s,onChange:r,type:"checkbox",checked:a,className:"sr-only peer"}),(0,n.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"}),(0,n.jsx)("span",{className:"ml-3 text-sm font-medium text-gray-900 dark:text-gray-300",children:t})]})}},4737:function(e,t,a){"use strict";var r=a(4214),s=a(8611);let n=r.default.create({baseURL:"".concat(s.env.NEXT_PUBLIC_BASE_URL,"/api"),headers:{"Content-Type":"application/json"}});t.Z=n},8856:function(e,t,a){"use strict";var r=a(4737);t.Z=class{static async createCourse(e,t){let a=await r.Z.post("/courses",t,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/form-data"}});return a.data}static updateCourse(e,t,a){return r.Z.put("/courses/".concat(t),a,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/form-data"}})}static async getCourseByID(e,t){return await r.Z.get("/courses/".concat(t,"?populate[instructor_id]=*&populate[course_image]=*&populate[tags][fields][0]=name&populate[lessons]=*"),{headers:{Authorization:"Bearer ".concat(e)}})}static async deleteByID(e,t){return await r.Z.delete("/courses/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}})}static async getCourses(e,t){let a=await r.Z.get("/courses?".concat(t||""),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}}},771:function(e,t,a){"use strict";var r=a(4737);t.Z=class{static async getLessons(e,t){let a=await r.Z.get("/lessons?".concat(t||""),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}static async getLessonById(e,t){let a=await r.Z.get("/lessons/".concat(t,"?populate[course][populate][course_image]=*&populate[thumbnail]=*&populate[media]=*&populate[course][populate][instructor_id]=*"),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}static async deleteByID(e,t){let a=await r.Z.delete("/lessons/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}static async createLesson(e,t){let a=await r.Z.post("/lessons",t,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/form-data"}});return a.data}static async updateLesson(e,t,a){let s=await r.Z.put("/lessons/".concat(t),a,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/form-data"}});return s.data}}},1375:function(e,t,a){"use strict";a.d(t,{E:function(){return s}});var r=a(353);let s=r.Ry({title:r.Z_().trim("lesson title should be valid").required("lessoon title is required"),description:r.Z_().trim("lesson description is required").required("lesson description is required"),order:r.Rx().required("lesson order is required")})},6628:function(){}},function(e){e.O(0,[5625,6680,6415,7079,3287,3296,1827,2162,8121,9173,1420,7240,4824,4214,5600,4088,1403,1644,9253,2961,1744],function(){return e(e.s=6482)}),_N_E=e.O()}]);