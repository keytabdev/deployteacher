(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6893],{5615:function(e,t,a){Promise.resolve().then(a.bind(a,3096))},3096:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var r=a(9268),s=a(443),n=a(5326),l=a.n(n),i=a(6006),c=a(4088),d=a(8856),o=a(9131),u=a(2855),m=a(8852),h=a(8919),g=a(4824),x=a(9457),p=a(6394),f=a.n(p),b=a(5372);function v(e){let{image:t,setImage:a,url:s,label:n}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"mb-2 block",htmlFor:"",children:n}),(0,r.jsxs)("div",{className:"relative mb-12 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"relative h-[300px] w-full overflow-hidden rounded-md",children:(0,r.jsx)(f(),{src:t?"".concat(URL.createObjectURL(t)):"".concat(s),alt:"",fill:!0,className:"rounded-md object-cover"})}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 top-0 z-20  flex h-full  w-full items-center justify-center  bg-[rgba(0,0,0,0.5)]",children:(0,r.jsxs)("div",{className:"flex h-[200px] w-full max-w-[250px] items-center justify-center text-white",children:[(0,r.jsx)("label",{htmlFor:"image-".concat(n),children:(0,r.jsxs)("div",{className:"flex cursor-pointer flex-col items-center justify-center gap-2 ",children:[(0,r.jsx)(b.tpQ,{className:"text-3xl"}),(0,r.jsx)("p",{className:"text-sm",children:"choose image to upload"})]})}),(0,r.jsx)("input",{onChange:function(e){e.target.files&&0!=e.target.files.length&&a(e.target.files[0])},type:"file",id:"image-".concat(n),className:"hidden"})]})})]})]})}var j=a(7694),y=a(1553),N=a(5846),w=a.n(N),Z=a(8611);function _(e){var t;let{course:a,session:n}=e,{handleChange:p,handleSubmit:f,values:b,errors:N,setInstructorId:_,image:C,loading:B,users:D,setImage:A,selectedTags:k,setSelectedTags:z,tags:S}=function(e,t){let{title:a,description:r,start_date:s,end_date:n,instructor_id:l,is_published:c}=e.data.attributes,p=(0,g.useQueryClient)(),[f,b]=(0,i.useState)(e.data.attributes.tags.data.map(e=>({value:e.id.toString(),label:e.attributes.name}))),{handleChange:v,handleSubmit:j,values:y,errors:N}=(0,m.TA)({initialValues:{name:a,description:r,startDate:s,endDate:n,isPublished:c},validationSchema:u.U,onSubmit(e){z(e)}}),[w,Z]=(0,i.useState)({value:l.data.id.toString(),label:l.data.attributes.username}),[_,C]=(0,i.useState)(),{mutateAsync:B,isLoading:D}=(0,g.useMutation)([t,null==e?void 0:e.data.id],a=>d.Z.updateCourse(t,null==e?void 0:e.data.id,a),{onSuccess:async()=>await p.invalidateQueries(["courses","select-courses"])}),{data:A}=(0,g.useQuery)(["tags"],()=>x.Z.getTags(t,"?fields[0]=name"),{onError:()=>h.ZP.error("something went wrong while fetching the tags please try again!"),staleTime:1/0}),{data:k}=(0,g.useQuery)(["users"],()=>(0,o.Rf)(t),{onError:()=>h.ZP.error("something went wrong while fetching the users please try again!"),staleTime:1/0});async function z(e){try{let t=new FormData;t.append("data",JSON.stringify({instructor_id:w.value,title:e.name,description:e.description,start_date:e.startDate,end_date:e.endDate,tags:[...f.map(e=>e.value)],is_published:e.isPublished})),_&&t.append("files.course_image",_),await B(t),h.ZP.success("course created successfully")}catch(e){h.ZP.error(e.response.data.error.message||"something went wrong, please try again!")}}return{handleChange:v,handleSubmit:j,values:y,errors:N,setInstructorId:Z,instructorId:w,image:_,loading:D,users:k,setImage:C,selectedTags:f,setSelectedTags:b,tags:A}}(a,null==n?void 0:n.token),I=null==D?void 0:D.map(e=>({value:e.id.toString(),label:null==e?void 0:e.username})),P=null==S?void 0:null===(t=S.data)||void 0===t?void 0:t.map(e=>{let{id:t,attributes:a}=e;return{value:"".concat(t),label:a.name}});return(0,r.jsxs)("div",{className:"",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("p",{children:"Update a course"}),(0,r.jsx)("h1",{className:"text-2xl font-bold",children:a.data.attributes.title})]}),(0,r.jsxs)("form",{onSubmit:f,className:"mb-12 rounded-md bg-white p-3 shadow-md",action:"",children:[(0,r.jsx)("div",{className:"mb-12",children:(0,r.jsx)(s.II,{value:b.name,name:"name",label:"Course name",variant:"filled",onChange:p,error:N.name})}),(0,r.jsx)("div",{className:"mb-12",children:(0,r.jsx)(s.gx,{name:"description",label:"Course description",variant:"filled",value:b.description,onChange:p,error:N.description})}),(0,r.jsx)("div",{className:" mb-12 ",children:(0,r.jsx)(v,{url:a.data.attributes.is_exported?a.data.attributes.course_image_url:Z.env.NEXT_PUBLIC_BASE_URL+a.data.attributes.course_image.data.attributes.url,image:C,setImage:A,label:"Course image"})}),(0,r.jsxs)("div",{className:"mb-12 grid grid-cols-1 gap-12  md:grid-cols-2 md:gap-8",children:[(0,r.jsx)(s.II,{name:"startDate",label:"Start date",type:"date",variant:"filled",value:l()(b.startDate).format("yyyy-MM-DD"),onChange:p,error:N.startDate}),(0,r.jsx)(s.II,{value:l()(b.endDate).format("yyyy-MM-DD"),name:"endDate",label:"End date",type:"date",variant:"filled",onChange:p,error:N.endDate})]}),(0,r.jsxs)("div",{className:"mb-12 grid grid-cols-1 gap-12  md:grid-cols-2 md:gap-8",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{htmlFor:"",className:"mb-2 text-sm",children:"Choose a instructor"}),(0,r.jsx)(c.ZP,{onChange:e=>_({value:null==e?void 0:e.value,label:null==e?void 0:e.label}),options:I,defaultValue:{value:a.data.attributes.instructor_id.data.id.toString(),label:a.data.attributes.instructor_id.data.attributes.username}})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("label",{htmlFor:"",className:"mb-2 text-sm",children:"Choose tags"}),(0,r.jsx)(c.ZP,{value:k,onChange:e=>{z(e.map(e=>({value:e.value,label:e.label})))},options:P,isMulti:!0})]})]}),(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)(s.ZD,{name:"isPublished",value:b.isPublished,onChange:p,title:"Publish"})}),(0,r.jsxs)("div",{className:"flex justify-end items-center gap-4",children:[(0,r.jsx)(s.zx,{loading:B,type:"submit",className:"w-fit text-white",children:"Update course"}),(0,r.jsx)(w(),{href:"".concat(Z.env.NEXT_PUBLIC_WEB_CLIENT_URL,"/my-curriculam/course/").concat(a.data.id),target:"_blank",children:(0,r.jsx)(s.zx,{type:"button",className:"w-fit border border-primary text-primary bg-white",children:"Preview course"})})]})]}),(0,r.jsx)("div",{className:"mb-12",children:(0,r.jsx)(j.default,{token:null==n?void 0:n.token,customQuery:a.data.id})}),(0,r.jsx)("div",{className:"mb-12",children:(0,r.jsx)(y.default,{token:null==n?void 0:n.token,customQuery:a.data.id})})]})}},7694:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var r=a(9268),s=a(1462),n=a(2992),l=a(4055),i=a(5326),c=a.n(i),d=a(8136),o=a(8582),u=a(4737),m=class{static async getEnrollments(e,t){let a=await u.Z.get("/enrollments?".concat(t||""),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}static async getByID(e,t){let a=await u.Z.get("/enrollments/".concat(t,"?populate=*"),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}static async deleteByID(e,t){let a=await u.Z.delete("/enrollments/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}},h=a(6006),g=a(8919),x=a(4824),p=a(7497),f=a.n(p);function b(e){let{token:t,customQuery:a}=e,{deleteEnrollment:i,enrollments:u,isLoading:p,query:b,setQuery:v,page:j,setPage:y}=function(e,t){let[a,r]=(0,h.useState)(""),[s,n]=(0,h.useState)(1),l=(0,o.Z)(a,500),i=f().stringify({sort:["createdAt:desc"],pagination:{page:s,pageSize:10},populate:{user_id:{fields:["username"]},course:{fields:["title"]}},fields:["enrollment_date"],filters:{$or:[{id:{$eq:l}},{course:{title:{$containsi:l}}},{user_id:{username:{$containsi:l}}}],course:{id:{$eq:t||""}}}},{encodeValuesOnly:!0}),{data:c,isLoading:d}=(0,x.useQuery)(["enrollments",l,s],()=>m.getEnrollments(e,i),{onError:()=>g.ZP.error("something went wrong please try again after refreshing")});return{deleteEnrollment:async function(t){return m.deleteByID(e,t)},enrollments:c,isLoading:d,query:a,setQuery:r,page:s,setPage:n}}(t,a);return(0,r.jsxs)("div",{className:"w-full p-4",children:[(0,r.jsxs)("div",{className:"ml-auto flex w-full items-center justify-between gap-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Enrollments"}),(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 rounded-md border bg-gray-100 px-3 py-3 dark:border-gray-600 dark:bg-primaryBg",children:[(0,r.jsx)(d.dVI,{className:"text-xl"}),(0,r.jsx)("input",{type:"text",className:"bg-transparent outline-none",placeholder:"search",onChange:e=>v(e.target.value),value:b})]})})]}),(0,r.jsxs)("div",{className:"mt-8 rounded-md shadow-lg",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full min-w-[750px] overflow-x-scroll rounded-md border bg-white p-4 shadow-lg dark:border-none dark:bg-primaryBg",children:[(0,r.jsx)("thead",{className:"border dark:border-gray-600",children:(0,r.jsxs)("tr",{className:"text-left",children:[(0,r.jsx)("td",{className:"p-4 font-bold",children:"ID"}),(0,r.jsx)("td",{className:"p-4 font-bold",children:"Username"}),(0,r.jsx)("td",{className:"p-4 font-bold",children:"Course Name"}),(0,r.jsx)("td",{className:"p-4 font-bold",children:"Enrollment At"}),(0,r.jsx)("td",{className:"p-4 text-right font-bold"})]})}),(0,r.jsx)("tbody",{className:"border dark:border-gray-600",children:p?(0,r.jsx)("td",{colSpan:5,className:"p-4 text-center",children:(0,r.jsx)(n.Z,{})}):(null==u?void 0:u.data)&&u.data.length>0?null==u?void 0:u.data.map(e=>{let{id:t,attributes:a}=e,{enrollment_date:n,course:l,user_id:d}=a;return(0,r.jsxs)("tr",{className:"dark:hover:bg-tra  w-full hover:bg-gray-100 dark:hover:bg-transparent",children:[(0,r.jsx)("td",{className:"p-4 text-left",children:t}),(0,r.jsx)("td",{className:"p-4 text-left",children:d.data.attributes.username}),(0,r.jsx)("td",{className:"p-4 text-left",children:l.data.attributes.title}),(0,r.jsx)("td",{className:"p-4 text-left",children:c()(n).format("DD-MMMM-YYYY")}),(0,r.jsx)("td",{className:"flex items-center justify-end gap-2 p-4",children:(0,r.jsx)(s.Z,{fn:i,title:"".concat(t),label:"enrollment",id:t.toString(),keys:["enrollments"]})})]},t)}):(0,r.jsx)("td",{colSpan:5,className:"p-4 text-center",children:"No enrollments found"})})]})}),(0,r.jsx)(l.Z,{page:j,pageCount:(null==u?void 0:u.meta.pagination.pageCount)||1,setPage:y})]})]})}},8856:function(e,t,a){"use strict";var r=a(4737);t.Z=class{static async createCourse(e,t){let a=await r.Z.post("/courses",t,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/form-data"}});return a.data}static updateCourse(e,t,a){return r.Z.put("/courses/".concat(t),a,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/form-data"}})}static async getCourseByID(e,t){return await r.Z.get("/courses/".concat(t,"?populate[instructor_id]=*&populate[course_image]=*&populate[tags][fields][0]=name&populate[lessons]=*"),{headers:{Authorization:"Bearer ".concat(e)}})}static async deleteByID(e,t){return await r.Z.delete("/courses/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}})}static async getCourses(e,t){let a=await r.Z.get("/courses?".concat(t||""),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}}},9457:function(e,t,a){"use strict";var r=a(4737);t.Z=class{static async getTags(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=await r.Z.get("/tags".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}static async getTagByID(e,t){let a=await r.Z.get("/tags/".concat(t,"?populate=*"),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}static async createTag(e,t){let a=await r.Z.post("/tags",t,{headers:{Authorization:"Bearer ".concat(e)}});return a.data}static async updateTag(e,t,a){let s=await r.Z.put("/tags/".concat(t),a,{headers:{Authorization:"Bearer ".concat(e)}});return s.data}static async deleteTag(e,t){let a=await r.Z.delete("/tags/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}}},9131:function(e,t,a){"use strict";a.d(t,{M1:function(){return n},Nq:function(){return l},Rf:function(){return s},XB:function(){return i}});var r=a(4737);a(8611);let s=async(e,t)=>{let a=await r.Z.get("/users".concat(t||""),{headers:{Authorization:"Bearer ".concat(e)}});return a.data},n=async(e,t)=>{let a=await r.Z.post("/auth/local/register",t);return a.data},l=async(e,t,a)=>{let s=await r.Z.put("/users/".concat(t),a,{headers:{Authorization:"Bearer ".concat(e)}});return s.data},i=async(e,t)=>{let a=await r.Z.delete("/users/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});return a.data}},2855:function(e,t,a){"use strict";a.d(t,{U:function(){return s}});var r=a(353);let s=r.Ry({name:r.Z_().trim("course  name should be valid").required("course name is required"),description:r.Z_().trim("course description is required").required("course description is required"),startDate:r.Z_().required("start date is required"),endDate:r.Z_().required("end date is required"),isPublished:r.O7().default(!1)})}},function(e){e.O(0,[5625,6680,6415,7079,3287,3296,1827,2162,8121,9173,4550,1420,7240,4824,4214,5600,4088,7497,1644,1789,9253,2961,1744],function(){return e(e.s=5615)}),_N_E=e.O()}]);